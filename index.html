<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase åˆå§‹åŒ–è¯Šæ–­ä¸ä¿®å¤å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px 30px;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .section h2 {
            color: #333;
            font-size: 24px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            padding-left: 12px;
        }
        
        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button.secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        button.success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        button.danger {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        .status-box {
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            font-size: 15px;
            line-height: 1.6;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .status-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }
        
        .status-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
        
        .status-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }
        
        .progress {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }
        
        .code-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .checklist {
            list-style: none;
            padding: 0;
        }
        
        .checklist li {
            padding: 12px 15px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #6c757d;
            transition: all 0.3s ease;
        }
        
        .checklist li:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .checklist li.done {
            border-left-color: #28a745;
            opacity: 0.7;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        #results {
            max-height: 600px;
            overflow-y: auto;
        }
        
        .metric {
            display: inline-block;
            padding: 8px 16px;
            background: #e9ecef;
            border-radius: 20px;
            margin: 5px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .metric.good {
            background: #d4edda;
            color: #155724;
        }
        
        .metric.bad {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ Supabase åˆå§‹åŒ–è¯Šæ–­å·¥å…·</h1>
            <p>æ™ºèƒ½æ£€æµ‹å’Œä¿®å¤ Supabase è¿æ¥é—®é¢˜</p>
        </div>
        
        <div class="content">
            <!-- å¿«é€Ÿè¯Šæ–­ -->
            <div class="section">
                <h2>âš¡ å¿«é€Ÿè¯Šæ–­</h2>
                <div class="button-group">
                    <button onclick="runFullDiagnostic()" class="success">
                        ğŸ” ä¸€é”®å…¨é¢è¯Šæ–­
                    </button>
                    <button onclick="quickFix()">
                        ğŸš€ æ™ºèƒ½å¿«é€Ÿä¿®å¤
                    </button>
                    <button onclick="clearCache()">
                        ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜
                    </button>
                </div>
            </div>
            
            <!-- çŠ¶æ€æ˜¾ç¤º -->
            <div id="results"></div>
            
            <!-- æ‰‹åŠ¨æµ‹è¯• -->
            <div class="section">
                <h2>ğŸ”¬ åˆ†æ­¥æµ‹è¯•</h2>
                <div class="button-group">
                    <button onclick="testStep1()">1ï¸âƒ£ æµ‹è¯•ç½‘ç»œè¿æ¥</button>
                    <button onclick="testStep2()">2ï¸âƒ£ æµ‹è¯• SDK åŠ è½½</button>
                    <button onclick="testStep3()">3ï¸âƒ£ æµ‹è¯•å®¢æˆ·ç«¯åˆå§‹åŒ–</button>
                    <button onclick="testStep4()">4ï¸âƒ£ æµ‹è¯•è®¤è¯æœåŠ¡</button>
                    <button onclick="testStep5()">5ï¸âƒ£ æµ‹è¯•æ•°æ®åº“è¿æ¥</button>
                </div>
            </div>
            
            <!-- å¸¸è§é—®é¢˜ -->
            <div class="section">
                <h2>ğŸ’¡ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</h2>
                <ul class="checklist">
                    <li>âœ… é¡¹ç›®è¢«æš‚åœ â†’ åœ¨ Supabase Dashboard ç‚¹å‡» Resume å¹¶ç­‰å¾… 2-5 åˆ†é’Ÿ</li>
                    <li>âœ… SDK åŠ è½½å¤±è´¥ â†’ æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜</li>
                    <li>âœ… åˆå§‹åŒ–è¶…æ—¶ â†’ é¡¹ç›®å¯èƒ½è¿˜åœ¨å¯åŠ¨ä¸­ï¼Œå†ç­‰å¾… 1-2 åˆ†é’Ÿ</li>
                    <li>âœ… CORS é”™è¯¯ â†’ æ£€æŸ¥ Supabase Dashboard çš„ URL é…ç½®</li>
                    <li>âœ… è®¤è¯å¤±è´¥ â†’ æ£€æŸ¥ Redirect URLs é…ç½®</li>
                </ul>
            </div>
            
            <!-- é…ç½®ä¿¡æ¯ -->
            <div class="section">
                <h2>âš™ï¸ å½“å‰é…ç½®</h2>
                <div class="code-box" id="config-info">
                    æ­£åœ¨åŠ è½½é…ç½®ä¿¡æ¯...
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // Supabase é…ç½®
        const SUPABASE_URL = 'https://wzjxtzpxojbmhwxropio.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind6anh0enB4b2pibWh3eHJvcGlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwNjQ3ODgsImV4cCI6MjA3NTY0MDc4OH0.lImwPZn-ca-d4oVWpQ5FUtXdM_NBvdkplqh1hUk3stQ';
        
        const results = document.getElementById('results');
        let supabaseClient = null;
        
        // å·¥å…·å‡½æ•°
        function addStatus(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status-box status-${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }
        
        function clearResults() {
            results.innerHTML = '';
        }
        
        function showProgress(percent) {
            const progressHtml = `
                <div class="progress">
                    <div class="progress-bar" style="width: ${percent}%"></div>
                </div>
            `;
            results.insertAdjacentHTML('beforeend', progressHtml);
        }
        
        // æ˜¾ç¤ºé…ç½®ä¿¡æ¯
        function showConfigInfo() {
            const config = document.getElementById('config-info');
            config.innerHTML = `
                <strong>Supabase URL:</strong> ${SUPABASE_URL}<br>
                <strong>Anon Key:</strong> ${SUPABASE_ANON_KEY.substring(0, 50)}...<br>
                <strong>æµè§ˆå™¨:</strong> ${navigator.userAgent}<br>
                <strong>å½“å‰æ—¶é—´:</strong> ${new Date().toLocaleString('zh-CN')}<br>
                <strong>é¡µé¢ URL:</strong> ${window.location.href}
            `;
        }
        
        // 1. æµ‹è¯•ç½‘ç»œè¿æ¥
        async function testStep1() {
            clearResults();
            addStatus('<strong>ğŸ” æ­¥éª¤ 1/5: æµ‹è¯•ç½‘ç»œè¿æ¥</strong>', 'info');
            
            try {
                addStatus('æ­£åœ¨è¿æ¥åˆ° Supabase æœåŠ¡å™¨...', 'info');
                
                const startTime = Date.now();
                const response = await Promise.race([
                    fetch(SUPABASE_URL, {
                        method: 'HEAD',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY
                        }
                    }),
                    new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('è¿æ¥è¶…æ—¶ (10ç§’)')), 10000)
                    )
                ]);
                
                const endTime = Date.now();
                const latency = endTime - startTime;
                
                if (response.ok || response.status === 404) {
                    addStatus(`
                        <strong>âœ… ç½‘ç»œè¿æ¥æˆåŠŸ</strong><br>
                        <span class="metric good">å»¶è¿Ÿ: ${latency}ms</span>
                        <span class="metric good">HTTP ${response.status}</span><br>
                        Supabase æœåŠ¡å™¨å¯ä»¥è®¿é—®ï¼
                    `, 'success');
                } else {
                    addStatus(`
                        <strong>âš ï¸ æœåŠ¡å™¨å“åº”å¼‚å¸¸</strong><br>
                        <span class="metric">HTTP ${response.status}</span>
                        <span class="metric bad">å»¶è¿Ÿ: ${latency}ms</span><br>
                        é¡¹ç›®å¯èƒ½æ­£åœ¨å¯åŠ¨ä¸­...
                    `, 'warning');
                }
                
            } catch (error) {
                addStatus(`
                    <strong>âŒ ç½‘ç»œè¿æ¥å¤±è´¥</strong><br>
                    é”™è¯¯: ${error.message}<br><br>
                    <strong>å¯èƒ½åŸå› :</strong><br>
                    1. â¸ï¸ Supabase é¡¹ç›®è¢«æš‚åœï¼ˆå…è´¹ç‰ˆ 7 å¤©æ— æ´»åŠ¨ä¼šæš‚åœï¼‰<br>
                    2. ğŸŒ ç½‘ç»œè¿æ¥é—®é¢˜ï¼ˆä¸­å›½å¤§é™†å¯èƒ½éœ€è¦ VPNï¼‰<br>
                    3. ğŸ”¥ é˜²ç«å¢™æˆ–å®‰å…¨è½¯ä»¶é˜»æ­¢<br><br>
                    <strong>è§£å†³æ–¹æ³•:</strong><br>
                    1. æ‰“å¼€ <a href="https://supabase.com/dashboard" target="_blank">Supabase Dashboard</a><br>
                    2. æ‰¾åˆ°é¡¹ç›®å¹¶ç‚¹å‡» "Resume" æˆ– "Restore"<br>
                    3. ç­‰å¾… 2-5 åˆ†é’Ÿåå†æ¬¡æµ‹è¯•
                `, 'error');
            }
        }
        
        // 2. æµ‹è¯• SDK åŠ è½½
        async function testStep2() {
            clearResults();
            addStatus('<strong>ğŸ” æ­¥éª¤ 2/5: æµ‹è¯• SDK åŠ è½½</strong>', 'info');
            
            if (typeof window.supabase === 'undefined') {
                addStatus(`
                    <strong>âŒ Supabase SDK æœªåŠ è½½</strong><br>
                    å¯èƒ½çš„åŸå› :<br>
                    1. CDN è¢«é˜»æ­¢ï¼ˆjsdelivr.netï¼‰<br>
                    2. æµè§ˆå™¨æ‰©å±•é˜»æ­¢äº†è„šæœ¬åŠ è½½<br>
                    3. ç½‘ç»œè¿æ¥é—®é¢˜<br><br>
                    <strong>å»ºè®®:</strong> å°è¯•å…³é—­å¹¿å‘Šæ‹¦æˆªå™¨æˆ–ä½¿ç”¨å…¶ä»–æµè§ˆå™¨
                `, 'error');
                return;
            }
            
            addStatus(`
                <strong>âœ… Supabase SDK åŠ è½½æˆåŠŸ</strong><br>
                <span class="metric good">ç‰ˆæœ¬: ${window.supabase.version || '2.x'}</span><br>
                SDK å·²æ­£ç¡®åŠ è½½ï¼Œå¯ä»¥ç»§ç»­ä¸‹ä¸€æ­¥ã€‚
            `, 'success');
        }
        
        // 3. æµ‹è¯•å®¢æˆ·ç«¯åˆå§‹åŒ–
        async function testStep3() {
            clearResults();
            addStatus('<strong>ğŸ” æ­¥éª¤ 3/5: æµ‹è¯•å®¢æˆ·ç«¯åˆå§‹åŒ–</strong>', 'info');
            
            if (typeof window.supabase === 'undefined') {
                addStatus('âŒ è¯·å…ˆè¿è¡Œæ­¥éª¤ 2', 'error');
                return;
            }
            
            try {
                addStatus('æ­£åœ¨åˆ›å»º Supabase å®¢æˆ·ç«¯...', 'info');
                
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
                    auth: {
                        persistSession: true,
                        autoRefreshToken: true,
                        detectSessionInUrl: true,
                        storage: window.localStorage,
                        storageKey: 'supabase.auth.token'
                    }
                });
                
                if (!supabaseClient) {
                    throw new Error('å®¢æˆ·ç«¯åˆ›å»ºå¤±è´¥');
                }
                
                addStatus(`
                    <strong>âœ… Supabase å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ</strong><br>
                    å®¢æˆ·ç«¯å¯¹è±¡å·²åˆ›å»ºï¼Œé…ç½®å·²åº”ç”¨ã€‚
                `, 'success');
                
            } catch (error) {
                addStatus(`
                    <strong>âŒ å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥</strong><br>
                    é”™è¯¯: ${error.message}<br><br>
                    è¿™é€šå¸¸è¡¨ç¤º SDK åŠ è½½ä¸å®Œæ•´æˆ–é…ç½®é”™è¯¯ã€‚
                `, 'error');
            }
        }
        
        // 4. æµ‹è¯•è®¤è¯æœåŠ¡
        async function testStep4() {
            clearResults();
            addStatus('<strong>ğŸ” æ­¥éª¤ 4/5: æµ‹è¯•è®¤è¯æœåŠ¡</strong>', 'info');
            
            if (!supabaseClient) {
                addStatus('âŒ è¯·å…ˆè¿è¡Œæ­¥éª¤ 3', 'error');
                return;
            }
            
            try {
                addStatus('æ­£åœ¨æµ‹è¯•è®¤è¯æœåŠ¡...', 'info');
                
                const startTime = Date.now();
                const { data, error } = await Promise.race([
                    supabaseClient.auth.getSession(),
                    new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('è®¤è¯æœåŠ¡è¶…æ—¶ (15ç§’)')), 15000)
                    )
                ]);
                
                const endTime = Date.now();
                const latency = endTime - startTime;
                
                if (error) {
                    throw error;
                }
                
                addStatus(`
                    <strong>âœ… è®¤è¯æœåŠ¡æ­£å¸¸</strong><br>
                    <span class="metric good">å“åº”æ—¶é—´: ${latency}ms</span><br>
                    <span class="metric">ä¼šè¯çŠ¶æ€: ${data.session ? 'å·²ç™»å½•' : 'æœªç™»å½•'}</span><br>
                    è®¤è¯æœåŠ¡å¯ä»¥æ­£å¸¸å·¥ä½œã€‚
                `, 'success');
                
                // æ£€æŸ¥ Redirect URLs
                const redirectUrl = window.location.origin;
                addStatus(`
                    <strong>ğŸ“‹ OAuth é…ç½®æ£€æŸ¥</strong><br>
                    å½“å‰ Redirect URL: <code>${redirectUrl}</code><br>
                    è¯·ç¡®ä¿åœ¨ Supabase Dashboard â†’ Authentication â†’ URL Configuration ä¸­æ·»åŠ æ­¤ URL
                `, 'info');
                
            } catch (error) {
                addStatus(`
                    <strong>âŒ è®¤è¯æœåŠ¡å¤±è´¥</strong><br>
                    é”™è¯¯: ${error.message}<br><br>
                    <strong>å¯èƒ½åŸå› :</strong><br>
                    1. é¡¹ç›®åˆšæ¢å¤ï¼Œè®¤è¯æœåŠ¡è¿˜æœªå®Œå…¨å¯åŠ¨ï¼ˆç­‰å¾… 2-3 åˆ†é’Ÿï¼‰<br>
                    2. é¡¹ç›®é…ç½®é”™è¯¯<br>
                    3. ç½‘ç»œä¸ç¨³å®š<br><br>
                    <strong>å»ºè®®:</strong> ç­‰å¾…ç‰‡åˆ»åé‡è¯•ï¼Œæˆ–æ£€æŸ¥ Supabase Dashboard é¡¹ç›®çŠ¶æ€
                `, 'error');
            }
        }
        
        // 5. æµ‹è¯•æ•°æ®åº“è¿æ¥
        async function testStep5() {
            clearResults();
            addStatus('<strong>ğŸ” æ­¥éª¤ 5/5: æµ‹è¯•æ•°æ®åº“è¿æ¥</strong>', 'info');
            
            if (!supabaseClient) {
                addStatus('âŒ è¯·å…ˆè¿è¡Œæ­¥éª¤ 3', 'error');
                return;
            }
            
            try {
                addStatus('æ­£åœ¨æµ‹è¯•æ•°æ®åº“è¿æ¥...', 'info');
                
                const startTime = Date.now();
                const { data, error } = await Promise.race([
                    supabaseClient.from('user_tasks').select('count', { count: 'exact', head: true }),
                    new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('æ•°æ®åº“æŸ¥è¯¢è¶…æ—¶ (15ç§’)')), 15000)
                    )
                ]);
                
                const endTime = Date.now();
                const latency = endTime - startTime;
                
                if (error) {
                    if (error.code === 'PGRST116') {
                        addStatus(`
                            <strong>âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸</strong><br>
                            <span class="metric good">å“åº”æ—¶é—´: ${latency}ms</span><br>
                            è¡¨ 'user_tasks' ä¸å­˜åœ¨æ˜¯æ­£å¸¸çš„ï¼ˆè¯´æ˜è¿æ¥æˆåŠŸï¼‰<br>
                            æ‚¨å¯ä»¥åœ¨ Supabase Dashboard ä¸­åˆ›å»ºæ­¤è¡¨ã€‚
                        `, 'success');
                    } else {
                        throw error;
                    }
                } else {
                    addStatus(`
                        <strong>âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸</strong><br>
                        <span class="metric good">å“åº”æ—¶é—´: ${latency}ms</span><br>
                        æ•°æ®åº“å¯ä»¥æ­£å¸¸è®¿é—®ï¼
                    `, 'success');
                }
                
            } catch (error) {
                addStatus(`
                    <strong>âŒ æ•°æ®åº“è¿æ¥å¤±è´¥</strong><br>
                    é”™è¯¯: ${error.message}<br><br>
                    <strong>å¯èƒ½åŸå› :</strong><br>
                    1. é¡¹ç›®åˆšæ¢å¤ï¼Œæ•°æ®åº“è¿˜æœªå®Œå…¨å¯åŠ¨ï¼ˆç­‰å¾… 3-5 åˆ†é’Ÿï¼‰<br>
                    2. æ•°æ®åº“æœåŠ¡å¼‚å¸¸<br>
                    3. API é™æµï¼ˆå…è´¹ç‰ˆæœ‰è¯·æ±‚é™åˆ¶ï¼‰<br><br>
                    <strong>å»ºè®®:</strong> ç­‰å¾…é¡¹ç›®å®Œå…¨å¯åŠ¨åé‡è¯•
                `, 'error');
            }
        }
        
        // ä¸€é”®å…¨é¢è¯Šæ–­
        async function runFullDiagnostic() {
            clearResults();
            addStatus('<strong>ğŸš€ å¼€å§‹å…¨é¢è¯Šæ–­...</strong>', 'info');
            showProgress(0);
            
            // æ­¥éª¤ 1
            await testStep1();
            showProgress(20);
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // æ­¥éª¤ 2
            await testStep2();
            showProgress(40);
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // æ­¥éª¤ 3
            await testStep3();
            showProgress(60);
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // æ­¥éª¤ 4
            await testStep4();
            showProgress(80);
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // æ­¥éª¤ 5
            await testStep5();
            showProgress(100);
            
            addStatus(`
                <strong>âœ… è¯Šæ–­å®Œæˆï¼</strong><br>
                è¯·æŸ¥çœ‹ä¸Šæ–¹çš„æµ‹è¯•ç»“æœï¼Œç»¿è‰²è¡¨ç¤ºæ­£å¸¸ï¼Œçº¢è‰²è¡¨ç¤ºæœ‰é—®é¢˜ã€‚
            `, 'success');
        }
        
        // æ™ºèƒ½å¿«é€Ÿä¿®å¤
        async function quickFix() {
            clearResults();
            addStatus('<strong>ğŸš€ æ­£åœ¨æ‰§è¡Œæ™ºèƒ½ä¿®å¤...</strong>', 'info');
            
            // 1. æ¸…é™¤ç¼“å­˜
            addStatus('1/4 æ­£åœ¨æ¸…é™¤æµè§ˆå™¨ç¼“å­˜...', 'info');
            try {
                localStorage.clear();
                sessionStorage.clear();
                addStatus('âœ… ç¼“å­˜å·²æ¸…é™¤', 'success');
            } catch (e) {
                addStatus('âš ï¸ æ— æ³•æ¸…é™¤ç¼“å­˜: ' + e.message, 'warning');
            }
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // 2. é‡æ–°åˆå§‹åŒ–å®¢æˆ·ç«¯
            addStatus('2/4 æ­£åœ¨é‡æ–°åˆå§‹åŒ– Supabase å®¢æˆ·ç«¯...', 'info');
            try {
                if (typeof window.supabase !== 'undefined') {
                    supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
                        auth: {
                            persistSession: true,
                            autoRefreshToken: true,
                            detectSessionInUrl: true,
                            storage: window.localStorage,
                            storageKey: 'supabase.auth.token'
                        }
                    });
                    addStatus('âœ… å®¢æˆ·ç«¯é‡æ–°åˆå§‹åŒ–æˆåŠŸ', 'success');
                } else {
                    addStatus('âš ï¸ SDK æœªåŠ è½½ï¼Œè·³è¿‡æ­¤æ­¥éª¤', 'warning');
                }
            } catch (e) {
                addStatus('âŒ å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥: ' + e.message, 'error');
            }
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // 3. æµ‹è¯•è¿æ¥
            addStatus('3/4 æ­£åœ¨æµ‹è¯• Supabase è¿æ¥...', 'info');
            try {
                const response = await fetch(SUPABASE_URL, {
                    method: 'HEAD',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY
                    }
                });
                
                if (response.ok || response.status === 404) {
                    addStatus('âœ… Supabase æœåŠ¡å™¨è¿æ¥æ­£å¸¸', 'success');
                } else {
                    addStatus(`âš ï¸ æœåŠ¡å™¨å“åº”å¼‚å¸¸ (HTTP ${response.status})`, 'warning');
                }
            } catch (e) {
                addStatus('âŒ æ— æ³•è¿æ¥åˆ° Supabase: ' + e.message, 'error');
            }
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // 4. éªŒè¯è®¤è¯æœåŠ¡
            addStatus('4/4 æ­£åœ¨éªŒè¯è®¤è¯æœåŠ¡...', 'info');
            if (supabaseClient) {
                try {
                    const { error } = await supabaseClient.auth.getSession();
                    if (error) {
                        addStatus(`âš ï¸ è®¤è¯æœåŠ¡å¼‚å¸¸: ${error.message}`, 'warning');
                        addStatus('é¡¹ç›®å¯èƒ½è¿˜åœ¨å¯åŠ¨ä¸­ï¼Œè¯·ç­‰å¾… 2-3 åˆ†é’Ÿååˆ·æ–°é¡µé¢', 'info');
                    } else {
                        addStatus('âœ… è®¤è¯æœåŠ¡æ­£å¸¸', 'success');
                    }
                } catch (e) {
                    addStatus('âŒ è®¤è¯æœåŠ¡é”™è¯¯: ' + e.message, 'error');
                }
            }
            
            addStatus(`
                <strong>ğŸ‰ å¿«é€Ÿä¿®å¤å®Œæˆï¼</strong><br><br>
                <strong>ä¸‹ä¸€æ­¥æ“ä½œ:</strong><br>
                1. å¦‚æœä»ç„¶æœ‰é”™è¯¯ï¼Œè¯·è¿è¡Œ"ä¸€é”®å…¨é¢è¯Šæ–­"æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯<br>
                2. å¦‚æœæ˜¯"é¡¹ç›®è¢«æš‚åœ"ï¼Œè¯·åˆ° Supabase Dashboard æ¢å¤é¡¹ç›®<br>
                3. é¡¹ç›®æ¢å¤åï¼Œéœ€è¦ç­‰å¾… 2-5 åˆ†é’Ÿè®©æœåŠ¡å®Œå…¨å¯åŠ¨<br>
                4. å®Œå…¨å¯åŠ¨åï¼Œåˆ·æ–°é¡µé¢å³å¯æ­£å¸¸ä½¿ç”¨
            `, 'success');
        }
        
        // æ¸…é™¤ç¼“å­˜
        function clearCache() {
            clearResults();
            addStatus('æ­£åœ¨æ¸…é™¤æ‰€æœ‰ç¼“å­˜...', 'info');
            
            try {
                localStorage.clear();
                sessionStorage.clear();
                
                // æ¸…é™¤ Supabase ç›¸å…³çš„å­˜å‚¨
                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.includes('supabase')) {
                        keysToRemove.push(key);
                    }
                }
                
                keysToRemove.forEach(key => localStorage.removeItem(key));
                
                addStatus(`
                    <strong>âœ… ç¼“å­˜æ¸…é™¤æˆåŠŸ</strong><br>
                    å·²æ¸…é™¤:<br>
                    â€¢ LocalStorage (${keysToRemove.length} ä¸ª Supabase ç›¸å…³é¡¹)<br>
                    â€¢ SessionStorage<br><br>
                    <strong>å»ºè®®:</strong> åˆ·æ–°é¡µé¢åé‡è¯•
                `, 'success');
                
            } catch (e) {
                addStatus('âŒ æ¸…é™¤ç¼“å­˜å¤±è´¥: ' + e.message, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºé…ç½®ä¿¡æ¯
        window.onload = () => {
            showConfigInfo();
        };
    </script>
</body>
</html>
