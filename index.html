# ğŸš€ Supabaseè®¾ç½®æŒ‡å—

è¿™ä»½æŒ‡å—å°†å¸®åŠ©æ‚¨é…ç½®Supabaseåç«¯ï¼Œå®ç°å¤šè®¾å¤‡æ•°æ®åŒæ­¥å’Œå¤šç”¨æˆ·æ”¯æŒã€‚

---

## ğŸ“‹ ç›®å½•

1. [åˆ›å»ºSupabaseè´¦å·](#1-åˆ›å»ºsupabaseè´¦å·)
2. [åˆ›å»ºæ–°é¡¹ç›®](#2-åˆ›å»ºæ–°é¡¹ç›®)
3. [è®¾ç½®æ•°æ®åº“](#3-è®¾ç½®æ•°æ®åº“)
4. [é…ç½®Google OAuth](#4-é…ç½®google-oauth)
5. [è·å–APIå¯†é’¥](#5-è·å–apiå¯†é’¥)
6. [æ›´æ–°å‰ç«¯ä»£ç ](#6-æ›´æ–°å‰ç«¯ä»£ç )
7. [æµ‹è¯•åº”ç”¨](#7-æµ‹è¯•åº”ç”¨)
8. [æ•…éšœæ’é™¤](#8-æ•…éšœæ’é™¤)

---

## 1. åˆ›å»ºSupabaseè´¦å·

1. è®¿é—® [https://supabase.com](https://supabase.com)
2. ç‚¹å‡» **"Start your project"** æˆ– **"Sign Up"**
3. ä½¿ç”¨GitHubè´¦å·ç™»å½•ï¼ˆæ¨èï¼‰æˆ–ä½¿ç”¨é‚®ç®±æ³¨å†Œ
4. å®Œæˆè´¦å·åˆ›å»º

---

## 2. åˆ›å»ºæ–°é¡¹ç›®

1. ç™»å½•åï¼Œç‚¹å‡» **"New Project"**
2. é€‰æ‹©æ‚¨çš„ç»„ç»‡ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼‰
3. å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼š
   - **Name**: `week-plan` æˆ–æ‚¨å–œæ¬¢çš„åç§°
   - **Database Password**: è®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ï¼ˆè¯·ä¿å­˜å¥½ï¼ï¼‰
   - **Region**: é€‰æ‹© **Northeast Asia (Tokyo)** ï¼ˆè·ç¦»ä¸­å›½æœ€è¿‘ï¼‰
   - **Pricing Plan**: é€‰æ‹© **Free** ï¼ˆå…è´¹ç‰ˆï¼‰
4. ç‚¹å‡» **"Create new project"**
5. ç­‰å¾…2-3åˆ†é’Ÿï¼Œé¡¹ç›®åˆå§‹åŒ–å®Œæˆ

---

## 3. è®¾ç½®æ•°æ®åº“

### 3.1 åˆ›å»ºè¡¨

1. åœ¨å·¦ä¾§èœå•ä¸­ï¼Œç‚¹å‡» **"Table Editor"**
2. ç‚¹å‡» **"Create a new table"**
3. é…ç½®è¡¨ï¼š
   - **Name**: `user_tasks`
   - **Description**: `ç”¨æˆ·ä»»åŠ¡æ•°æ®`
   - **Enable Row Level Security (RLS)**: âœ… **å‹¾é€‰**

### 3.2 æ·»åŠ åˆ—

ä¿ç•™é»˜è®¤çš„ `id` å’Œ `created_at` åˆ—ï¼Œç„¶åæ·»åŠ ä»¥ä¸‹åˆ—ï¼š

| Column Name | Type | Default Value | Additional Settings |
|------------|------|---------------|-------------------|
| `user_id` | `uuid` | - | âœ… Is Nullable: å–æ¶ˆå‹¾é€‰ |
| `tasks` | `jsonb` | `[]` | âœ… Is Nullable: å‹¾é€‰ |
| `calendar_tasks` | `jsonb` | `[]` | âœ… Is Nullable: å‹¾é€‰ |
| `updated_at` | `timestamptz` | `now()` | âœ… Is Nullable: å‹¾é€‰ |

### 3.3 è®¾ç½®ä¸»é”®å’Œå”¯ä¸€çº¦æŸ

1. ç‚¹å‡»è¡¨åæ—çš„ âš™ï¸ **"Settings"**
2. æ·»åŠ å”¯ä¸€çº¦æŸï¼š
   - ç‚¹å‡» **"Add Unique Constraint"**
   - é€‰æ‹© `user_id` åˆ—
   - ç‚¹å‡» **"Save"**

### 3.4 é…ç½®è¡Œçº§å®‰å…¨(RLS)ç­–ç•¥

éå¸¸é‡è¦ï¼è¿™ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®ã€‚

#### æ–¹æ³•1ï¼šä½¿ç”¨SQLç¼–è¾‘å™¨ï¼ˆæ¨èï¼‰

1. åœ¨å·¦ä¾§èœå•ä¸­ï¼Œç‚¹å‡» **"SQL Editor"**
2. ç‚¹å‡» **"New query"**
3. ç²˜è´´ä»¥ä¸‹SQLä»£ç ï¼š

```sql
-- åˆ›å»ºç­–ç•¥ï¼šå…è®¸ç”¨æˆ·è¯»å–è‡ªå·±çš„æ•°æ®
CREATE POLICY "Users can read own tasks" ON user_tasks
    FOR SELECT
    USING (auth.uid() = user_id);

-- åˆ›å»ºç­–ç•¥ï¼šå…è®¸ç”¨æˆ·æ’å…¥è‡ªå·±çš„æ•°æ®
CREATE POLICY "Users can insert own tasks" ON user_tasks
    FOR INSERT
    WITH CHECK (auth.uid() = user_id);

-- åˆ›å»ºç­–ç•¥ï¼šå…è®¸ç”¨æˆ·æ›´æ–°è‡ªå·±çš„æ•°æ®
CREATE POLICY "Users can update own tasks" ON user_tasks
    FOR UPDATE
    USING (auth.uid() = user_id)
    WITH CHECK (auth.uid() = user_id);

-- åˆ›å»ºç­–ç•¥ï¼šå…è®¸ç”¨æˆ·åˆ é™¤è‡ªå·±çš„æ•°æ®
CREATE POLICY "Users can delete own tasks" ON user_tasks
    FOR DELETE
    USING (auth.uid() = user_id);
```

4. ç‚¹å‡» **"Run"** æ‰§è¡ŒSQL
5. ç¡®è®¤æ˜¾ç¤º **"Success"**

#### æ–¹æ³•2ï¼šä½¿ç”¨UIç•Œé¢

1. åœ¨ **Table Editor** ä¸­ï¼Œé€‰æ‹© `user_tasks` è¡¨
2. ç‚¹å‡» **"Policies"** æ ‡ç­¾
3. ç‚¹å‡» **"New Policy"**
4. é€‰æ‹© **"Create a policy from scratch"**
5. é‡å¤ä»¥ä¸‹æ­¥éª¤4æ¬¡ï¼ˆSELECT, INSERT, UPDATE, DELETEï¼‰ï¼š

**SELECT Policy:**
- Policy Name: `Users can read own tasks`
- Target roles: `public`
- Command: `SELECT`
- USING expression: `auth.uid() = user_id`

**INSERT Policy:**
- Policy Name: `Users can insert own tasks`
- Target roles: `public`
- Command: `INSERT`
- WITH CHECK expression: `auth.uid() = user_id`

**UPDATE Policy:**
- Policy Name: `Users can update own tasks`
- Target roles: `public`
- Command: `UPDATE`
- USING expression: `auth.uid() = user_id`
- WITH CHECK expression: `auth.uid() = user_id`

**DELETE Policy:**
- Policy Name: `Users can delete own tasks`
- Target roles: `public`
- Command: `DELETE`
- USING expression: `auth.uid() = user_id`

---

## 4. é…ç½®Google OAuth

### 4.1 åˆ›å»ºGoogle OAuthå‡­æ®

1. è®¿é—® [Google Cloud Console](https://console.cloud.google.com/)
2. åˆ›å»ºæ–°é¡¹ç›®æˆ–é€‰æ‹©ç°æœ‰é¡¹ç›®
3. å¯ç”¨ **Google+ API**ï¼š
   - æœç´¢ "Google+ API"
   - ç‚¹å‡» **"Enable"**
4. åˆ›å»ºOAuthå‡­æ®ï¼š
   - å·¦ä¾§èœå• â†’ **APIs & Services** â†’ **Credentials**
   - ç‚¹å‡» **"Create Credentials"** â†’ **"OAuth client ID"**
   - Application type: **Web application**
   - Name: `Week Plan`
   - Authorized redirect URIsï¼ˆéå¸¸é‡è¦ï¼ï¼‰ï¼š
     - å›åˆ°Supabaseï¼Œå·¦ä¾§èœå• â†’ **Authentication** â†’ **Providers**
     - æ‰¾åˆ° **Google** æä¾›å•†
     - å¤åˆ¶ **"Callback URL (for OAuth)"**ï¼ˆç±»ä¼¼ï¼š`https://xxx.supabase.co/auth/v1/callback`ï¼‰
     - ç²˜è´´åˆ°Google Consoleçš„"Authorized redirect URIs"
   - ç‚¹å‡» **"Create"**
5. å¤åˆ¶ç”Ÿæˆçš„ï¼š
   - **Client ID**
   - **Client Secret**

### 4.2 åœ¨Supabaseä¸­é…ç½®Google

1. åœ¨Supabaseï¼Œå·¦ä¾§èœå• â†’ **Authentication** â†’ **Providers**
2. æ‰¾åˆ° **Google**ï¼Œç‚¹å‡»å±•å¼€
3. æ‰“å¼€ **"Enable Sign in with Google"** å¼€å…³
4. å¡«å…¥ï¼š
   - **Client ID**: ç²˜è´´Googleçš„Client ID
   - **Client Secret**: ç²˜è´´Googleçš„Client Secret
5. ç‚¹å‡» **"Save"**

---

## 5. è·å–APIå¯†é’¥

1. åœ¨Supabaseï¼Œå·¦ä¾§èœå• â†’ **Settings** â†’ **API**
2. æ‰¾åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **Project URL** (ä¾‹å¦‚: `https://xxxxx.supabase.co`)
   - **anon public** key (ä»¥ `eyJ` å¼€å¤´çš„é•¿å­—ç¬¦ä¸²)
3. **å¤åˆ¶è¿™ä¸¤ä¸ªå€¼ï¼Œæ¥ä¸‹æ¥è¦ç”¨**

---

## 6. æ›´æ–°å‰ç«¯ä»£ç 

1. æ‰“å¼€ `index.htmlu` æ–‡ä»¶
2. æ‰¾åˆ°ç¬¬594-595è¡Œï¼ˆåœ¨ `<script>` æ ‡ç­¾å†…ï¼‰ï¼š

```javascript
const SUPABASE_URL = 'YOUR_SUPABASE_URL_HERE'
const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY_HERE'
```

3. æ›¿æ¢ä¸ºæ‚¨çš„å®é™…å€¼ï¼š

```javascript
const SUPABASE_URL = 'https://xxxxx.supabase.co'  // æ›¿æ¢ä¸ºæ‚¨çš„Project URL
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'  // æ›¿æ¢ä¸ºæ‚¨çš„anon key
```

4. ä¿å­˜æ–‡ä»¶

---

## 7. æµ‹è¯•åº”ç”¨

### 7.1 æœ¬åœ°æµ‹è¯•

1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `index.html`
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   âœ… Supabase initialized
   ```
3. ç‚¹å‡» **"ç™»å½•"** æŒ‰é’®
4. å°è¯•ä»¥ä¸‹ç™»å½•æ–¹å¼ï¼š

#### æµ‹è¯•é‚®ç®±ç™»å½•ï¼š
1. ç‚¹å‡» **"æ³¨å†Œ"**
2. è¾“å…¥é‚®ç®±å’Œå¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰
3. ç‚¹å‡» **"æ³¨å†Œ"**
4. æ£€æŸ¥é‚®ç®±ï¼Œç‚¹å‡»éªŒè¯é“¾æ¥
5. è¿”å›åº”ç”¨ï¼Œç‚¹å‡» **"ç™»å½•"**
6. ä½¿ç”¨ç›¸åŒçš„é‚®ç®±å’Œå¯†ç ç™»å½•

#### æµ‹è¯•Googleç™»å½•ï¼š
1. ç‚¹å‡» **"ä½¿ç”¨ Google ç™»å½•"**
2. é€‰æ‹©Googleè´¦å·
3. å…è®¸æˆæƒ
4. åº”è¯¥è‡ªåŠ¨è¿”å›åº”ç”¨å¹¶ç™»å½•æˆåŠŸ

### 7.2 éªŒè¯åŠŸèƒ½

ç™»å½•æˆåŠŸåï¼Œåº”è¯¥çœ‹åˆ°ï¼š
- âœ… å·¦ä¾§é¢æ¿æ˜¾ç¤ºç”¨æˆ·å¤´åƒå’Œé‚®ç®±
- âœ… æ˜¾ç¤º **"åŒæ­¥"** å’Œ **"ç™»å‡º"** æŒ‰é’®
- âœ… å¯ä»¥åˆ›å»ºä»»åŠ¡
- âœ… ä»»åŠ¡è‡ªåŠ¨ä¿å­˜åˆ°äº‘ç«¯

### 7.3 æµ‹è¯•è·¨è®¾å¤‡åŒæ­¥

1. åœ¨ç¬¬ä¸€ä¸ªè®¾å¤‡ä¸Šåˆ›å»ºä¸€äº›ä»»åŠ¡
2. åœ¨ç¬¬äºŒä¸ªè®¾å¤‡ï¼ˆæˆ–æµè§ˆå™¨éšèº«æ¨¡å¼ï¼‰æ‰“å¼€åº”ç”¨
3. ä½¿ç”¨ç›¸åŒè´¦å·ç™»å½•
4. åº”è¯¥çœ‹åˆ°ç›¸åŒçš„ä»»åŠ¡æ•°æ®ï¼

---

## 8. æ•…éšœæ’é™¤

### âŒ æ§åˆ¶å°æ˜¾ç¤º "Supabase not configured"

**åŸå› **: æœªæ­£ç¡®é…ç½®APIå¯†é’¥

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ `SUPABASE_URL` å’Œ `SUPABASE_ANON_KEY` æ˜¯å¦æ­£ç¡®
- ç¡®ä¿æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–å¼•å·
- ä¿å­˜æ–‡ä»¶ååˆ·æ–°æµè§ˆå™¨

---

### âŒ Googleç™»å½•å¤±è´¥ "redirect_uri_mismatch"

**åŸå› **: Google Consoleä¸­çš„é‡å®šå‘URIé…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. å›åˆ°Supabase â†’ **Authentication** â†’ **Providers** â†’ **Google**
2. å¤åˆ¶å®Œæ•´çš„ "Callback URL"
3. å›åˆ°Google Console â†’ **Credentials**
4. ç¼–è¾‘OAuthå®¢æˆ·ç«¯
5. ç¡®ä¿ "Authorized redirect URIs" **å®Œå…¨åŒ¹é…** Supabaseçš„Callback URL
6. ä¿å­˜åç­‰å¾…5åˆ†é’Ÿå†æµ‹è¯•

---

### âŒ é‚®ç®±æ³¨å†Œåæ— æ³•ç™»å½•

**åŸå› **: é‚®ç®±æœªéªŒè¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥é‚®ç®±çš„åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹
2. æ‰¾åˆ°Supabaseå‘é€çš„éªŒè¯é‚®ä»¶
3. ç‚¹å‡»éªŒè¯é“¾æ¥
4. è¿”å›åº”ç”¨é‡æ–°ç™»å½•

å¦‚æœæ²¡æ”¶åˆ°é‚®ä»¶ï¼š
1. Supabase â†’ **Authentication** â†’ **Providers** â†’ **Email**
2. æ£€æŸ¥ "Confirm email" æ˜¯å¦å¼€å¯
3. å¯ä»¥æš‚æ—¶å…³é—­ä»¥ä¾¿æµ‹è¯•ï¼ˆä¸æ¨èç”Ÿäº§ç¯å¢ƒï¼‰

---

### âŒ RLSé”™è¯¯ "new row violates row-level security policy"

**åŸå› **: RLSç­–ç•¥é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. é‡æ–°æ‰§è¡Œç¬¬3.4èŠ‚çš„SQLå‘½ä»¤
2. æˆ–è€…åœ¨ Supabase â†’ **Table Editor** â†’ `user_tasks` â†’ **Policies**
3. ç¡®ä¿æ‰€æœ‰4ä¸ªç­–ç•¥ï¼ˆSELECT, INSERT, UPDATE, DELETEï¼‰éƒ½å·²åˆ›å»º
4. æ£€æŸ¥ç­–ç•¥çš„è¡¨è¾¾å¼æ˜¯å¦ä¸º `auth.uid() = user_id`

---

### âŒ æ•°æ®æ²¡æœ‰åŒæ­¥

**åŸå› **: æµè§ˆå™¨ç¼“å­˜æˆ–ç½‘ç»œé—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:
1. ç‚¹å‡» **"åŒæ­¥"** æŒ‰é’®æ‰‹åŠ¨åŒæ­¥
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. åˆ·æ–°é¡µé¢ (F5)
4. æ£€æŸ¥ Supabase â†’ **Table Editor** â†’ `user_tasks`ï¼Œç¡®è®¤æ•°æ®å·²ä¿å­˜

---

## ğŸ‰ å®Œæˆï¼

æ­å–œï¼æ‚¨å·²ç»æˆåŠŸé…ç½®äº†Supabaseåç«¯ã€‚ç°åœ¨æ‚¨çš„åº”ç”¨æ”¯æŒï¼š

âœ… **ç”¨æˆ·è®¤è¯** (Google + é‚®ç®±/å¯†ç )
âœ… **å¤šç”¨æˆ·éš”ç¦»** (æ¯ä¸ªç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„æ•°æ®)
âœ… **è·¨è®¾å¤‡åŒæ­¥** (åœ¨ä»»ä½•è®¾å¤‡ç™»å½•éƒ½èƒ½çœ‹åˆ°æ•°æ®)
âœ… **äº‘ç«¯å¤‡ä»½** (æ•°æ®å®‰å…¨å­˜å‚¨åœ¨Supabase)
âœ… **å…è´¹ä½¿ç”¨** (Supabaseå…è´¹ç‰ˆéå¸¸æ…·æ…¨)

---

## ğŸ“Š å…è´¹ç‰ˆé™é¢

Supabaseå…è´¹ç‰ˆæä¾›ï¼š
- âœ… 500MB æ•°æ®åº“å­˜å‚¨
- âœ… 50,000 æœˆæ´»è·ƒç”¨æˆ·
- âœ… 2GB å¸¦å®½/æœˆ
- âœ… ç¤¾åŒºæ”¯æŒ

å¯¹äºä¸ªäººä½¿ç”¨æˆ–å°å‹å›¢é˜Ÿï¼Œå…è´¹ç‰ˆå®Œå…¨å¤Ÿç”¨ï¼

---

## ğŸš€ ä¸‹ä¸€æ­¥ï¼ˆå¯é€‰ï¼‰

### éƒ¨ç½²åˆ°Vercelï¼ˆå…è´¹æ‰˜ç®¡ï¼‰

1. è®¿é—® [vercel.com](https://vercel.com)
2. æ³¨å†Œå¹¶è¿æ¥GitHub
3. åˆ›å»ºæ–°ä»“åº“ï¼Œä¸Šä¼  `index.html`
4. åœ¨Vercelå¯¼å…¥ä»“åº“
5. éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ªå…¬å¼€URL
6. è®°å¾—æ›´æ–°Google OAuthçš„é‡å®šå‘URIï¼

### æ·»åŠ å®æ—¶åŒæ­¥ï¼ˆé«˜çº§ï¼‰

å¦‚æœæ‚¨æƒ³è¦å¤šè®¾å¤‡å®æ—¶åŒæ­¥ï¼ˆä¸éœ€è¦ç‚¹å‡»"åŒæ­¥"æŒ‰é’®ï¼‰ï¼Œå¯ä»¥æ·»åŠ ï¼š

```javascript
// åœ¨ script ä¸­æ·»åŠ 
if (supabase) {
    supabase
        .channel('tasks-changes')
        .on('postgres_changes', {
            event: '*',
            schema: 'public',
            table: 'user_tasks',
            filter: `user_id=eq.${currentUser?.id}`
        }, (payload) => {
            console.log('æ•°æ®æ›´æ–°ï¼', payload)
            loadDataFromSupabase()
        })
        .subscribe()
}
```

---

## ğŸ’¡ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼š

1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å° (F12) æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
2. æŸ¥çœ‹Supabaseæ–‡æ¡£: [https://supabase.com/docs](https://supabase.com/docs)
3. è”ç³»æˆ‘è·å–æ›´å¤šå¸®åŠ©

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰âœ¨

